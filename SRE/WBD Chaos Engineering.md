# WBD Chaos Engineering

- [WBD Chaos Engineering](#wbd-chaos-engineering)
  - [Dimensions and Skills](#dimensions-and-skills)
  - [WBD](#wbd)
  - [Fault as a Service (FaaS)](#fault-as-a-service-faas)
  - [BOLT](#bolt)
    - [1. 为什么叫 BOLT（统一与效率）](#1-为什么叫-bolt统一与效率)
    - [2. BOLT 解决的关键问题](#2-bolt-解决的关键问题)
    - [3. 与 KEDA 的关联](#3-与-keda-的关联)
    - [4. 行业背景](#4-行业背景)
    - [总结一下](#总结一下)
  - [关于BOLT的深度解析](#关于bolt的深度解析)
    - [1. 名字由来与读法](#1-名字由来与读法)
    - [2. 架构概览 (Architecture)](#2-架构概览-architecture)
      - [核心架构组件](#核心架构组件)
    - [3. 开发背景：什么时候开始的？](#3-开发背景什么时候开始的)
    - [4. 它解决旧问题了吗？](#4-它解决旧问题了吗)
    - [5. 它的缺点和瓶颈是什么？](#5-它的缺点和瓶颈是什么)
  - [BOLT Front: Fastly, AGA, ALB](#bolt-front-fastly-aga-alb)
    - [1. Fastly (边缘层：离用户最近的“哨兵”)](#1-fastly-边缘层离用户最近的哨兵)
    - [2. AWS AGA (Global Accelerator) (网络层：跨国访问的“高速公路”)](#2-aws-aga-global-accelerator-网络层跨国访问的高速公路)
    - [3. AWS ALB (Application Load Balancer) (入口层：进入 BOLT 的“分拣员”)](#3-aws-alb-application-load-balancer-入口层进入-bolt-的分拣员)
    - [流量流向图](#流量流向图)
    - [为什么 BOLT 要把这三个叠在一起？](#为什么-bolt-要把这三个叠在一起)
    - [1. 其他行业是怎么用的？](#1-其他行业是怎么用的)
    - [2. 为什么大家都这么设计？（行业公认逻辑）](#2-为什么大家都这么设计行业公认逻辑)
      - [第一层：CDN (如 Fastly) —— 解决“距离”问题](#第一层cdn-如-fastly--解决距离问题)
      - [第二层：全球加速 (如 AWS AGA) —— 解决“路径”问题](#第二层全球加速-如-aws-aga--解决路径问题)
      - [第三层：负载均衡 (如 AWS ALB) —— 解决“门口”问题](#第三层负载均衡-如-aws-alb--解决门口问题)
    - [3. BOLT 特有的设计考量：为什么是这个组合？](#3-bolt-特有的设计考量为什么是这个组合)
    - [总结](#总结)


## Dimensions and Skills

工作聚焦于 FaaS（混沌工程），这要求您从平台编排 (EKS/Istio)、可观测性 (Prometheus) 和弹性/混沌 (FIS/Litmus) 三个维度入手。

## WBD

HBO current architecture -> BOLT architecture
HBO previous problems and RCA - study old problems, test for Chaos engineering, 80/20 to prioritize
Related Teams and POCs - better understand architecture, impact & scopes of Chaos engineering; regular 1:1

## Fault as a Service (FaaS)

Current: who/ which team, what, how, when, how to verify; current scope; gap to future

---

## BOLT

**Bolt** 是 WBD 内部打造的一套**统一后端平台（Unified Backend Platform）**。它的出现是为了解决一个巨大的技术债：由于 WBD 是由多家媒体公司（如 Discovery 和 WarnerMedia）合并而成的，不同平台（如 HBO Max, Discovery+, Eurosport）原本都有各自独立的后端架构。

以下是 BOLT 的核心要点和它为什么对 WBD 如此重要：

### 1. 为什么叫 BOLT（统一与效率）

在合并之后，WBD 的首席技术官 (CTO) Avi Saxena 启动了 Bolt 项目。它的核心目标是：**“一套后端，支持全球所有品牌”**。

- **统一性：** 无论你是在看 HBO Max 上的《最后生还者》，还是在 Discovery+ 上看纪录片，底层的账户管理、内容分发、支付系统和元数据处理都是由 Bolt 平台统一承载的。
- **一致性：** 确保在 100 多个国家、几十种语言的设备上，用户体验（比如“继续观看”功能、推荐算法）是同步且高质量的。

### 2. BOLT 解决的关键问题

如果你之前关注过 KEDA 和 HPA 的伸缩问题，那么 Bolt 的设计初衷恰好能对上：

- **高并发压力：** 像《龙之家族》首播时，瞬间会有数千万用户涌入。Bolt 被设计成可以极速伸缩的架构，能够应对这种“爆发式”流量。
- **复杂的内容编排：** WBD 拥有极其庞大的资源库（从体育直播到经典电影）。Bolt 作为一个中枢，负责把这些复杂的内容标签化，并快速推送到不同的前端 App 上。

### 3. 与 KEDA 的关联

虽然你提到的“BOLT”是业务平台名，但从技术架构上看，它在底层大量应用了你之前感兴趣的**云原生技术**。

- 为了支撑 Bolt 这样庞大的全球服务，WBD 的技术团队必须处理复杂的**弹性伸缩（Scaling）**逻辑。
- 你之前提到的 KEDA 获取信息不及时的问题，很可能就是 Bolt 团队在尝试用事件驱动（Event-driven）的方式来优化后端服务响应时遇到的挑战。

### 4. 行业背景

- **HBO Max 变身 Max：** 2023 年至 2024 年间，HBO Max 在美国等地更名为 “Max”。这次大迁移背后的技术底座正是 Bolt。它让 WBD 能够把 Discovery+ 的海量内容无缝合并到原有的 HBO 架构中。
- **AI 的加入：** 最新的消息显示，Bolt 平台正在引入 AI 来优化内容推荐和系统测试。

### 总结一下

**BOLT** 就是 WBD  streaming 业务的**超级引擎**。

- **WBD/HBO Max** 是车壳和品牌。
- **BOLT** 是发动机和底盘。
- **KEDA/HPA** 是发动机里的自动调节气门（伸缩机制）。

---

## 关于BOLT的深度解析

关于 **BOLT**，这在流媒体技术圈（尤其是北美 WBD 团队）是一个非常硬核的话题。它不仅是一个后端平台，更是 WBD 媒体帝国技术转型的核心。

### 1. 名字由来与读法

- **名字含义：** BOLT 并非某个长句子的缩写（Acronym），而是一个**意向性名字**。它取自“闪电”（Lightning Bolt）的含义，象征着**极速（Speed）**、**能量（Power）**和**连接（Connection）**。在合并了 WarnerMedia 和 Discovery 的复杂背景下，这个名字代表了团队希望技术架构能够像闪电一样快速响应全球亿万用户的需求。
- **怎么读：** 读音与英文单词 **"bolt"** 完全一致，音标为 **/boʊlt/**（类似于中文拼音“波特”，但末尾带轻声 't'）。

### 2. 架构概览 (Architecture)

BOLT 的核心架构理念是 **“Global, Unified, and Scalable”**。它摒弃了过去那种为每个地区或品牌单独构建烟囱式系统的做法。

#### 核心架构组件

- **多租户抽象层 (Multi-tenant Layer)：** 一套代码同时支持 Max、Discovery+、CNN 等不同品牌。通过配置而非硬编码来区分品牌逻辑。
- **事件驱动架构 (EDA)：** 这就是为什么你会听到 **KEDA**。BOLT 大量使用异步消息（如 Kafka、SQS）来触发任务。
- **微服务联邦 (Microservices Federation)：** 采用 GraphQL 联邦架构，让前端可以通过一个统一的入口（Supergraph）访问后台数百个微服务（用户、支付、内容元数据等）。
- **全球分布式数据平面：** 利用 AWS 的多区域（Multi-region）部署，确保用户数据在离他最近的节点处理，减少播放卡顿。

### 3. 开发背景：什么时候开始的？

BOLT 的大规模开发始于 **2022 年 4 月** Warner Bros. 与 Discovery 正式合并之后。

- **起因：** 当时 CTO Avi Saxena（前 Amazon 高管）面临一个巨大的挑战：HBO Max 当时的架构在处理《龙之家族》等超大流量时非常吃力，且维护成本极高。
- **转折点：** 2023 年 5 月，Max 在美国正式上线，标志着 BOLT 平台完成了第一次真正的全球级实战验证。

### 4. 它解决旧问题了吗？

**答案是肯定的，它非常有效地解决了以下三个顽疾：**

1. **发布效率：** 以前更新一个功能（如“个性化推荐”）需要为三个 App 改三遍代码。现在在 BOLT 上改一次，全球所有品牌同步生效。
2. **弹性伸缩 (Scalability)：** 借助你提到的 KEDA 等技术，它实现了“预测性扩容”。在热门大剧上线前的几分钟，系统能根据历史模型自动拉起数千个 Pod，而不是等流量打爆了 CPU 才动作。
3. **成本优化：** 通过统一平台，减少了大量的重复基础设施支出。

### 5. 它的缺点和瓶颈是什么？

没有任何架构是完美的，BOLT 也有其明显的“成长的烦恼”：

- **过度中心化的风险 (Single Point of Failure)：** 因为所有品牌都跑在一个平台上，如果 BOLT 的核心逻辑出问题（比如你提到的 KEDA 指标获取不及时导致扩容失败），可能导致全球所有品牌集体瘫痪。
- **信息获取的延迟（即你提到的 KEDA 问题）：**
  - **瓶颈：** 由于 BOLT 规模巨大，它依赖的底层信息源（如某些遗留的元数据数据库）在高频访问下会变慢。
  - **现状：** KEDA 如果拿不到及时的“活儿有多少”的信息，就会导致伸缩决策失误。
- **内部认知负载 (Cognitive Load)：** 系统太庞大、太抽象。一个新加入的工程师可能需要好几个月才能搞清楚 BOLT 内部复杂的 YAML 配置和事件流向。
- **“一刀切”的灵活性限制：** 有时某个品牌（如 CNN）想要一个极其特殊的功能，但在 BOLT 这种大一统架构下，为了保持标准，可能很难快速满足这种定制化需求。

---

## BOLT Front: Fastly, AGA, ALB

这是一个非常典型的**全球规模（Global Scale）**流媒体平台架构。BOLT 这样设计，是为了解决一个核心矛盾：**如何在让全球数亿用户极速访问的同时，还能保证后端 K8s 集群（BOLT 核心）的稳定性和安全性？**

这三者（Fastly, AGA, ALB）像三道关卡，层层递进，各自解决不同的痛点：

### 1. Fastly (边缘层：离用户最近的“哨兵”)

Fastly 是一个 **边缘计算和 CDN 平台**。

- **为什么要用它？**
  - **极速响应：** 视频的图片、剧集元数据、静态网页等，直接缓存在 Fastly 遍布全球的边缘节点（POP）。用户请求不需要飞过大洋到达美国机房，在“家门口”就拿到了。
  - **瞬间扩容（Shock Absorber）：** 像《龙之家族》首播时，每秒会有数百万请求。Fastly 能挡住 **90% 以上**的流量（缓存命中），真正到达后端 BOLT 系统的请求只占极少数，这大大减轻了 KEDA 的压力。
  - **边缘逻辑：** Fastly 的 VCL/Compute@Edge 可以在边缘直接处理简单的逻辑（如：根据用户国家重定向），不用进 K8s。

### 2. AWS AGA (Global Accelerator) (网络层：跨国访问的“高速公路”)

如果请求没被 Fastly 拦截（缓存未命中），它就需要飞向 AWS 后端。

- **为什么要用它？**
  - **优化网络路径：** 互联网公网波动很大（丢包、延迟）。AGA 让用户的请求一旦进入 AWS 的网络边缘，就立即走 **AWS 内部的私有光纤骨干网**，而不是走拥堵的公共互联网。
  - **固定 IP：** AGA 提供两个全球固定的任播（Anycast）IP，即使后端 ALB 换了，前端也不用改 DNS。
  - **智能调度：** 如果美东机房挂了，AGA 会自动把流量切到美西机房，用户几乎无感知。

### 3. AWS ALB (Application Load Balancer) (入口层：进入 BOLT 的“分拣员”)

这是进入你提到的 BOLT 系统（运行在 EKS/K8s 上）的最后一道大门。

- **为什么要用它？**
  - **协议转换：** 处理 HTTPS 证书卸载，把加密流量转为 K8s 内部流量。
  - **微服务分发：** ALB 识别 URL 路径。比如 `/user` 指向用户服务，`/video` 指向视频服务。
  - **联动 KEDA/HPA：** ALB 的指标（如 RequestCountPerTarget）是 KEDA 最喜欢的数据源。KEDA 盯着 ALB 的流量变化，来决定 BOLT 里的 Pod 要不要扩容。

### 流量流向图

1. **用户** 发起请求 ⮕
2. **Fastly**（有缓存吗？有就直接回，没有就往后传） ⮕
3. **AWS AGA**（走 AWS 内部最快的“光纤特快”直达机房） ⮕
4. **AWS ALB**（分拣请求：去用户微服务？还是支付微服务？） ⮕
5. **BOLT (K8s Pods)**（真正的业务逻辑处理）

### 为什么 BOLT 要把这三个叠在一起？

| 维度 | 设计目的 | 如果缺少了会怎样？ |
| --- | --- | --- |
| **Fastly** | 性能、成本、防 DDoS | 后端会被海量重复请求打挂，AWS 账单会爆炸。 |
| **AWS AGA** | 解决全球网络不稳定 | 跨国用户（如在欧洲看美区内容）会感到明显的加载延迟和卡顿。 |
| **AWS ALB** | 实现复杂的后端路由和伸缩 | 无法精准地将流量分给 K8s 里的不同微服务。 |

---

这种“三道关卡”的设计（**CDN + 全球加速器 + 负载均衡**）不仅是流媒体行业的标准，也是**所有全球化高并发业务**（如大型社交网络、头部 AI 公司、跨境电商）通用的“三板斧”。

虽然不同公司使用的品牌不同（比如有的用 Cloudflare 替代 Fastly），但逻辑是完全一致的。

### 1. 其他行业是怎么用的？

| 行业 | 代表公司 | 第一层 (CDN/边缘) | 第二层 (网络加速) | 第三层 (入口分摊) |
| --- | --- | --- | --- | --- |
| **流媒体** | **Netflix** | **Open Connect** (自建 CDN) | 主要是内部骨干网 | **Zuul** (自研 Gateway) |
| **AI 领域** | **OpenAI / ChatGPT** | **Cloudflare** (挡住全球请求) | **Azure Front Door** (类似 AGA) | **K8s Ingress / ALB** |
| **社交网络** | **TikTok (字节跳动)** | **Akamai / 自建边缘节点** | **Global Private Backbone** | **L7 Load Balancer** |
| **电商/游戏** | **米哈游 (原神)** | **Cloudflare / Akamai** | **AWS AGA** (减少延迟) | **AWS NLB/ALB** |

### 2. 为什么大家都这么设计？（行业公认逻辑）

虽然这三道关卡看起来很贵、很复杂，但它们分别解决了**距离、路径和门口**的问题：

#### 第一层：CDN (如 Fastly) —— 解决“距离”问题

- **核心任务：** 缓存静态资源，让 95% 的请求在“家门口”就结束。
- **为什么必选：** 如果没有这一层，后端 BOLT 或 ChatGPT 的服务器会瞬间被那些只是来“拿图片”或“查静态配置”的请求淹没。
- **差异化：** **Fastly** 在流媒体圈很火，是因为它的清除缓存速度极快（毫秒级），这对于需要实时更新直播元数据、修改视频权限的 WBD 来说至关重要。

#### 第二层：全球加速 (如 AWS AGA) —— 解决“路径”问题

- **核心任务：** 让还没被缓存拦截的“深层请求”不要走拥挤的公网。
- **为什么必选：** 公网（Public Internet）就像普通公路，红绿灯多、路况差。**AGA** 就像 AWS 内部的私人高速公路。
- **AI 公司的刚需：** 对于 ChatGPT 这种无法缓存的动态对话，AGA 级别的加速是降低延迟（Latency）的关键，否则你问个问题可能要在公网上跳转几十次才到服务器。

#### 第三层：负载均衡 (如 AWS ALB) —— 解决“门口”问题

- **核心任务：** 把流量安全、精准地交给 K8s 里的具体 Pod。
- **与 KEDA 的契约：** 这是离业务最近的一层，ALB 会告诉 KEDA：“现在每秒有 5000 个人在访问播放列表接口，你现在的 10 个 Pod 肯定不够，快去扩容！”

### 3. BOLT 特有的设计考量：为什么是这个组合？

在 WBD 的场景下，这种组合是为了解决**极高爆发力**：

- **Fastly + KEDA：** 正常情况下，Fastly 挡住大部分流量。但在《龙之家族》首播或奥运会直播时，缓存穿透率会升高。这时候需要后端 BOLT 系统**提前感知**。
- **AGA 的容灾：** 如果 AWS 的某个区域（如美东）光缆断了，AGA 会在几秒钟内把全球流量导向美西。如果没有 AGA，修改 DNS 指标（TTL）通常需要几分钟甚至几小时才能生效，这在直播场景下是不可接受的。

### 总结

你看到的这套设计是**目前人类构建全球规模互联网服务的最优解**。

- **CDN (Fastly)** 是盾牌。
- **加速器 (AGA)** 是传送门。
- **均衡器 (ALB)** 是分拣台。

---